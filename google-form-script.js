// Google Formé€ä¿¡æ™‚ã«è‡ªå‹•ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

function onFormSubmit(e) {
  try {
    // ãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­”ã‚’å–å¾—
    var itemResponses = e.response.getItemResponses();
    var email = "";
    var name = "";
    var eventDate = "";
    
    // Google Formã®ã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åé›†ã€æ©Ÿèƒ½ã‹ã‚‰å–å¾—ã‚’è©¦ã¿ã‚‹
    try {
      email = e.response.getRespondentEmail();
      Logger.log("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ï¼ˆè‡ªå‹•åé›†ï¼‰: " + email);
    } catch (error) {
      Logger.log("è‡ªå‹•åé›†ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—å¤±æ•—: " + error.toString());
    }
    
    // å„ãƒ•ã‚©ãƒ¼ãƒ é …ç›®ã‹ã‚‰æƒ…å ±ã‚’å–å¾—
    for (var i = 0; i < itemResponses.length; i++) {
      var itemResponse = itemResponses[i];
      var title = itemResponse.getItem().getTitle();
      var response = itemResponse.getResponse();
      
      // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ï¼ˆè³ªå•é …ç›®ã‹ã‚‰ï¼‰
      if (!email && (title.indexOf("ãƒ¡ãƒ¼ãƒ«") !== -1 || title.indexOf("Email") !== -1 || title.indexOf("email") !== -1)) {
        email = response;
        Logger.log("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ï¼ˆè³ªå•é …ç›®ï¼‰: " + email);
      }
      // åå‰ã‚’å–å¾—
      if (title.indexOf("ãŠåå‰") !== -1 || title.indexOf("æ°å") !== -1 || title.indexOf("åå‰") !== -1) {
        name = response;
        Logger.log("åå‰å–å¾—: " + name);
      }
      // å‚åŠ å¸Œæœ›æ—¥ã‚’å–å¾—
      if (title.indexOf("å‚åŠ å¸Œæœ›æ—¥") !== -1 || title.indexOf("é–‹å‚¬æ—¥") !== -1) {
        eventDate = response;
        Logger.log("å‚åŠ å¸Œæœ›æ—¥å–å¾—: " + eventDate);
      }
    }
    
    // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆ
    if (!email) {
      Logger.log("ã‚¨ãƒ©ãƒ¼: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ");
      return;
    }
    
    // åå‰ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    if (!name) {
      name = "ãŠå®¢æ§˜";
    }
    
    // ãƒ¡ãƒ¼ãƒ«ä»¶å
    var subject = "ã€Smart & Smoothã€‘ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚²ãƒ¼ãƒ ä½“é¨“ç ”ä¿® ãŠç”³ã—è¾¼ã¿å—ä»˜å®Œäº†";
    
    // ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡
    var body = name + " æ§˜\n\n" +
               "ã“ã®åº¦ã¯ã€ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚²ãƒ¼ãƒ  1æ—¥çµŒå–¶ä½“é¨“ç ”ä¿®ã«ãŠç”³ã—è¾¼ã¿ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚\n\n" +
               "ãŠç”³ã—è¾¼ã¿ã‚’å—ã‘ä»˜ã‘ã„ãŸã—ã¾ã—ãŸã€‚\n\n";
    
    // å‚åŠ å¸Œæœ›æ—¥ãŒå–å¾—ã§ããŸå ´åˆã¯è¿½åŠ 
    if (eventDate) {
      body += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
              "ğŸ“… ã”å¸Œæœ›ã®é–‹å‚¬æ—¥\n" +
              "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n" +
              eventDate + "\n\n";
    }
    
    body += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
            "ğŸ“‹ ä»Šå¾Œã®æµã‚Œ\n" +
            "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n" +
            "1. 3å–¶æ¥­æ—¥ä»¥å†…ã«ã€æ‹…å½“è€…ã‚ˆã‚Šç¢ºèªã®ã”é€£çµ¡ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™\n" +
            "2. é–‹å‚¬æ—¥ã®1é€±é–“å‰ã«ã€è©³ç´°æ¡ˆå†…ï¼ˆä¼šå ´ãƒ»æŒã¡ç‰©ãªã©ï¼‰ã‚’ãƒ¡ãƒ¼ãƒ«ã§ãŠé€ã‚Šã—ã¾ã™\n" +
            "3. ãŠæ”¯æ‰•ã„ã¯ã€äº‹å‰éŠ€è¡ŒæŒ¯è¾¼ã¾ãŸã¯å½“æ—¥ç¾é‡‘ãƒ»PayPayã‚’ãŠé¸ã³ã„ãŸã ã‘ã¾ã™\n\n" +
            "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
            "ğŸ“ è©³ç´°æƒ…å ±\n" +
            "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n" +
            "ã“ã¡ã‚‰ã®ãƒšãƒ¼ã‚¸ã§è©³ç´°ã‚’ã”ç¢ºèªã„ãŸã ã‘ã¾ã™ï¼š\n" +
            "https://smartandsmooth.com/trial/thank-you.html\n\n" +
            "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
            "ğŸ’° å‚åŠ è²»ç”¨\n" +
            "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n" +
            "ã€å€‹äººå‘ã‘ç‰¹åˆ¥ä¾¡æ ¼ã€‘10,000å††ï¼ˆç¨è¾¼ï¼‰\n" +
            "â€»ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ï¼ˆ2å›ç›®ä»¥é™ï¼‰ã®æ–¹ï¼š7,000å††ï¼ˆç¨è¾¼ï¼‰\n\n" +
            "è²»ç”¨ã«ã¯ç ”ä¿®æ•™æã€ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰åˆ©ç”¨æ–™ã€è¬›å¸«æŒ‡å°æ–™ãŒå«ã¾ã‚Œã¾ã™ã€‚\n" +
            "é ˜åæ›¸ã®ç™ºè¡Œã‚‚å¯èƒ½ã§ã™ã€‚\n\n" +
            "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
            "ğŸ“ ãŠå•ã„åˆã‚ã›\n" +
            "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n" +
            "ã”ä¸æ˜ç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ã“ã®ãƒ¡ãƒ¼ãƒ«ã«è¿”ä¿¡ã™ã‚‹å½¢ã§ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n\n" +
            "åˆåŒä¼šç¤¾ Smart & Smooth\n" +
            "ä»£è¡¨ï¼šå‰±æŒ å¥\n" +
            "ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼šhttps://smartandsmooth.com\n\n" +
            "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n" +
            "â€»ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯è‡ªå‹•é€ä¿¡ã•ã‚Œã¦ã„ã¾ã™ã€‚\n" +
            "â€»ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„å ´åˆã¯ã€è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã”ç¢ºèªãã ã•ã„ã€‚\n";
    
    // ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    GmailApp.sendEmail(email, subject, body);
    
    // ãƒ­ã‚°ã«è¨˜éŒ²
    Logger.log("ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ: " + email + " (åå‰: " + name + ")");
    
  } catch (error) {
    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
    Logger.log("ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: " + error.toString());
  }
}

// ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã™ã‚‹é–¢æ•°ï¼ˆåˆå›ã®ã¿å®Ÿè¡Œï¼‰
function createTrigger() {
  try {
    // æ—¢å­˜ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’å‰Šé™¤
    var triggers = ScriptApp.getProjectTriggers();
    for (var i = 0; i < triggers.length; i++) {
      ScriptApp.deleteTrigger(triggers[i]);
    }
    
    // æ–°ã—ã„ãƒˆãƒªã‚¬ãƒ¼ã‚’ä½œæˆ
    var form = FormApp.getActiveForm();
    ScriptApp.newTrigger('onFormSubmit')
      .forForm(form)
      .onFormSubmit()
      .create();
    
    Logger.log("ãƒˆãƒªã‚¬ãƒ¼è¨­å®šå®Œäº†");
    
  } catch (error) {
    Logger.log("ãƒˆãƒªã‚¬ãƒ¼è¨­å®šã‚¨ãƒ©ãƒ¼: " + error.toString());
  }
}

// ãƒ†ã‚¹ãƒˆç”¨é–¢æ•°ï¼ˆæ‰‹å‹•å®Ÿè¡Œã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ãƒ†ã‚¹ãƒˆï¼‰
function testEmailSend() {
  var testEmail = "kenmochi@smartandsmooth.com"; // â† ã”è‡ªèº«ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›´
  var testName = "ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼";
  
  var subject = "ã€Smart & Smoothã€‘ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚²ãƒ¼ãƒ ä½“é¨“ç ”ä¿® ãŠç”³ã—è¾¼ã¿å—ä»˜å®Œäº†ï¼ˆãƒ†ã‚¹ãƒˆï¼‰";
  
  var body = testName + " æ§˜\n\n" +
             "ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ã§ã™ã€‚\n\n" +
             "è©³ç´°ã¯ã“ã¡ã‚‰ï¼š\n" +
             "https://smartandsmooth.com/trial/thank-you.html\n\n" +
             "åˆåŒä¼šç¤¾ Smart & Smooth\n";
  
  try {
    GmailApp.sendEmail(testEmail, subject, body);
    Logger.log("ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ: " + testEmail);
  } catch (error) {
    Logger.log("ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼: " + error.toString());
  }
}
